# Config values for local Querki development
# This gets merged into the main values in application.conf iff you are running a local build.
# Nothing here is sacred -- feel free to adjust to suit your own needs -- but this is how Justin handles
# his development environment. See https://github.com/jducoeur/Querki/wiki/Setting-up-a-local-Querki-install
# for more context.

local {
  querki {
    akka {
      # The default timeout to use unless stated otherwise:
      timeout: 15 seconds
    }

    app {
      urlRoot: "http://localhost:9000/"
    }

    apps {
    }

    aws {
      region : "us-east-1"
      # For LOCAL DEVELOPMENT ONLY, the endpoint to the Secrets Manager. In the prod environment, the default works.
      secretsEndpoint : "http://host.docker.internal:4566"
      # The name of the HOCON file in Secrets Manager that contains the configuration for the secrets:
      secretsName : "querki/app/secrets"
      bucket : "querki-dev1"
      bucketUrl : "//s3-us-west-2.amazonaws.com/querki-dev1"
    }

    cluster {
      size : 1
      shardRelookupTimeout : 10 seconds
      snapshotInterval : 5
      allocBlockSize : 3
      allocSnapshotInterval : 3
      newObjCreate : true
    }

    conversations {
      timeout : 30 seconds
    }

    debug {
      //    space {
      //      7w4g7wj {
      //        trace : true
      //        block : false
      //      }
      //    }
    }

    history {
      timeout : 90 seconds
    }

    mail {
      # When set to true, this turns off the real email stack and just prints out the emails instead:
      dev : true

      smtpHost : "smtp.gmail.com"
      port : 587
      from : "artimatestsender@gmail.com"
      systemFrom : "artimatestsender@gmail.com"
      systemName : "Querki"
      debug : true
      identityTimeout : 30 seconds
      throttle : 5 seconds
    }

    # Flags controlling whether to profile certain aspects of the system.
    # Profiling is very rough-and-ready at this point -- we could improve it a lot.
    profile {
      AccessControl {
        hasPermission : false
        hasPermissionFunc : false
      }

      Invocation : false

      Methods {
        allqlApply : false
      }

      Person : true

      QLEcot {
        parserCreate : false
        parserProcess : true
        parserProcessMethod : false
      }

      QLParser {
        parse : true
        processMethod : false
        processCall : false
        processTextStage : false
        processNumber : false
        processThing : false
        call : false
        wikify : false
      }

      Session {
        getThingPage : true
        renderThingPage : true
      }

      SpaceState : false
    }

    # TODO: these were named "public" because they were originally the only publicly-visible parts of config.
    # That's no longer true, so move these to a more appropriate name.
    public {
      maxSpaces : 5
      maxMembersPerSpace : 5
    }

    publication {
      log : true
    }

    redirect {
      from : "0.0.0.0"
      to : "http://localhost:9000"
    }

    session {
      timeout : 45 seconds
    }

    space {
      timeout : 2 minutes
      snapshotInterval : 10
      logAllMsgs : true
    }

    stream {
      stringChunkSize : 1000
    }

    userSession {
      timeout : 1 minute
      collaborators {
        timeout : 30 seconds
      }
    }
  }

  akka {
    remote {
      netty.tcp {
        port = 2553
      }
    }

    cluster {
      seed-nodes = [
        "akka.tcp://application@127.0.0.1:2553"
      ]
    }

    actor {
    }
  }

  # Database configuration
  # ~~~~~

  # MySQL configuration for the System tables...
  db.system.driver=com.mysql.jdbc.Driver
  db.system.url="jdbc:mysql://host.docker.internal/querkisystem?characterEncoding=UTF-8"
  db.system.logStatements=false

  # ... and for the User tables:
  db.user.driver=com.mysql.jdbc.Driver
  db.user.url="jdbc:mysql://host.docker.internal/querkiuser?characterEncoding=UTF-8"
  db.user.logStatements=false

  # Expand the PermGen memory
  # Suggested here: https://groups.google.com/forum/#!msg/play-framework/IIXRyqFn7l0/68ZHU9uhfAgJ
  jvm.memory=Xms128m Xmx1024m

  play-akka {
    akka {
      cluster {
        seed-nodes = [
          "akka.tcp://application@127.0.0.1:2552"
        ]
      }
    }
  }
}
