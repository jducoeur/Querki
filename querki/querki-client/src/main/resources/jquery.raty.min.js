/*!
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.5.2
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 *
 */

(function(e){var t={init:function(n){return this.each(function(){t.destroy.call(this);this.opt=e.extend(true,{},e.fn.raty.defaults,n);var r=e(this),i=["number","readOnly","score","scoreName"];t._callback.call(this,i);if(this.opt.precision){t._adjustPrecision.call(this)}this.opt.number=t._between(this.opt.number,0,this.opt.numberMax);this.opt.path=this.opt.path||"";if(this.opt.path&&this.opt.path.slice(this.opt.path.length-1,this.opt.path.length)!=="/"){this.opt.path+="/"}this.stars=t._createStars.call(this);this.score=t._createScore.call(this);t._apply.call(this,this.opt.score);var s=this.opt.space?4:0,o=this.opt.width||this.opt.number*this.opt.size+this.opt.number*s;if(this.opt.cancel){this.cancel=t._createCancel.call(this);o+=this.opt.size+s}if(this.opt.readOnly){t._lock.call(this)}else{r.css("cursor","pointer");t._binds.call(this)}if(this.opt.width!==false){r.css("width",o)}t._target.call(this,this.opt.score);r.data({settings:this.opt,raty:true})})},_adjustPrecision:function(){this.opt.targetType="score";this.opt.half=true},_apply:function(e){if(e&&e>0){e=t._between(e,0,this.opt.number);this.score.val(e)}t._fill.call(this,e);if(e){t._roundStars.call(this,e)}},_between:function(e,t,n){return Math.min(Math.max(parseFloat(e),t),n)},_binds:function(){if(this.cancel){t._bindCancel.call(this)}t._bindClick.call(this);t._bindOut.call(this);t._bindOver.call(this)},_bindCancel:function(){t._bindClickCancel.call(this);t._bindOutCancel.call(this);t._bindOverCancel.call(this)},_bindClick:function(){var t=this,n=e(t);t.stars.on("click.raty",function(e){t.score.val(t.opt.half||t.opt.precision?n.data("score"):this.alt);if(t.opt.click){t.opt.click.call(t,parseFloat(t.score.val()),e)}})},_bindClickCancel:function(){var e=this;e.cancel.on("click.raty",function(t){e.score.removeAttr("value");if(e.opt.click){e.opt.click.call(e,null,t)}})},_bindOut:function(){var n=this;e(this).on("mouseleave.raty",function(e){var r=parseFloat(n.score.val())||undefined;t._apply.call(n,r);t._target.call(n,r,e);if(n.opt.mouseout){n.opt.mouseout.call(n,r,e)}})},_bindOutCancel:function(){var t=this;t.cancel.on("mouseleave.raty",function(n){e(this).attr("src",t.opt.path+t.opt.cancelOff);if(t.opt.mouseout){t.opt.mouseout.call(t,t.score.val()||null,n)}})},_bindOverCancel:function(){var n=this;n.cancel.on("mouseover.raty",function(r){e(this).attr("src",n.opt.path+n.opt.cancelOn);n.stars.attr("src",n.opt.path+n.opt.starOff);t._target.call(n,null,r);if(n.opt.mouseover){n.opt.mouseover.call(n,null)}})},_bindOver:function(){var n=this,r=e(n),i=n.opt.half?"mousemove.raty":"mouseover.raty";n.stars.on(i,function(i){var s=parseInt(this.alt,10);if(n.opt.half){var o=parseFloat((i.pageX-e(this).offset().left)/n.opt.size),u=o>.5?1:.5;s=s-1+u;t._fill.call(n,s);if(n.opt.precision){s=s-u+o}t._roundStars.call(n,s);r.data("score",s)}else{t._fill.call(n,s)}t._target.call(n,s,i);if(n.opt.mouseover){n.opt.mouseover.call(n,s,i)}})},_callback:function(e){for(i in e){if(typeof this.opt[e[i]]==="function"){this.opt[e[i]]=this.opt[e[i]].call(this)}}},_createCancel:function(){var t=e(this),n=this.opt.path+this.opt.cancelOff,r=e("<img />",{src:n,alt:"x",title:this.opt.cancelHint,"class":"raty-cancel"});if(this.opt.cancelPlace=="left"){t.prepend("&#160;").prepend(r)}else{t.append("&#160;").append(r)}return r},_createScore:function(){return e("<input />",{type:"hidden",name:this.opt.scoreName}).appendTo(this)},_createStars:function(){var n=e(this);for(var r=1;r<=this.opt.number;r++){var i=t._getHint.call(this,r),s=this.opt.score&&this.opt.score>=r?"starOn":"starOff";s=this.opt.path+this.opt[s];if(this.opt.target){e("<img />",{src:s,alt:r}).appendTo(this)}else{e("<img />",{src:s,alt:r,title:i}).appendTo(this)}if(this.opt.space){n.append(r<this.opt.number?"&#160;":"")}}return n.children("img")},_error:function(t){e(this).html(t);e.error(t)},_fill:function(e){var t=this,n=0;for(var r=1;r<=t.stars.length;r++){var i=t.stars.eq(r-1),s=t.opt.single?r==e:r<=e;if(t.opt.iconRange&&t.opt.iconRange.length>n){var o=t.opt.iconRange[n],u=o.on||t.opt.starOn,a=o.off||t.opt.starOff,f=s?u:a;if(r<=o.range){i.attr("src",t.opt.path+f)}if(r==o.range){n++}}else{var f=s?"starOn":"starOff";i.attr("src",this.opt.path+this.opt[f])}}},_getHint:function(e){var t=this.opt.hints[e-1];return t===""?"":t||(e==0?"":e)},_lock:function(){var n=parseInt(this.score.val(),10),r=n?t._getHint.call(this,n):this.opt.noRatedMsg;e(this).data("readonly",true).css("cursor","").attr("title",r);this.score.attr("readonly","readonly");this.stars.attr("title",r);if(this.cancel){this.cancel.hide()}},_roundStars:function(e){var t=(e-Math.floor(e)).toFixed(2);if(t>this.opt.round.down){var n="starOn";if(this.opt.halfShow&&t<this.opt.round.up){n="starHalf"}else if(t<this.opt.round.full){n="starOff"}this.stars.eq(Math.ceil(e)-1).attr("src",this.opt.path+this.opt[n])}},_target:function(n,r){if(this.opt.target){var i=e(this.opt.target);if(i.length===0){t._error.call(this,"Target selector invalid or missing!")}if(this.opt.targetFormat.indexOf("{score}")<0){t._error.call(this,'Template "{score}" missing!')}var s=r&&r.type=="mouseover";if(n===undefined){n=this.opt.targetText}else if(n===null){n=s?this.opt.cancelHint:this.opt.targetText}else{if(this.opt.targetType=="hint"){n=t._getHint.call(this,Math.ceil(n))}else if(this.opt.precision){n=parseFloat(n).toFixed(1)}if(!s&&!this.opt.targetKeep){n=this.opt.targetText}}if(n){n=this.opt.targetFormat.toString().replace("{score}",n)}if(i.is(":input")){i.val(n)}else{i.html(n)}}},_unlock:function(){e(this).data("readonly",false).css("cursor","pointer").removeAttr("title");this.score.removeAttr("readonly","readonly");for(var n=0;n<this.opt.number;n++){this.stars.eq(n).attr("title",t._getHint.call(this,n+1))}if(this.cancel){this.cancel.css("display","")}},cancel:function(n){return this.each(function(){if(e(this).data("readonly")!==true){t[n?"click":"score"].call(this,null);this.score.removeAttr("value")}})},click:function(n){return e(this).each(function(){if(e(this).data("readonly")!==true){t._apply.call(this,n);if(!this.opt.click){t._error.call(this,'You must add the "click: function(score, evt) { }" callback.')}this.opt.click.call(this,n,{type:"click"});t._target.call(this,n)}})},destroy:function(){return e(this).each(function(){var t=e(this),n=t.data("raw");if(n){t.off(".raty").empty().css({cursor:n.style.cursor,width:n.style.width}).removeData("readonly")}else{t.data("raw",t.clone()[0])}})},getScore:function(){var t=[],n;e(this).each(function(){n=this.score.val();t.push(n?parseFloat(n):undefined)});return t.length>1?t:t[0]},readOnly:function(n){return this.each(function(){var r=e(this);if(r.data("readonly")!==n){if(n){r.off(".raty").children("img").off(".raty");t._lock.call(this)}else{t._binds.call(this);t._unlock.call(this)}r.data("readonly",n)}})},reload:function(){return t.set.call(this,{})},score:function(){return arguments.length?t.setScore.apply(this,arguments):t.getScore.call(this)},set:function(t){return this.each(function(){var n=e(this),r=n.data("settings"),i=e.extend({},r,t);n.raty(i)})},setScore:function(n){return e(this).each(function(){if(e(this).data("readonly")!==true){t._apply.call(this,n);t._target.call(this,n)}})}};e.fn.raty=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist!")}};e.fn.raty.defaults={cancel:false,cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:"",precision:false,readOnly:false,round:{down:.25,full:.6,up:.76},score:undefined,scoreName:"score",single:false,size:16,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:false,targetText:"",targetType:"hint",width:undefined}})(jQuery)