package controllers

import scala.concurrent.ExecutionContext.Implicits._

import querki.notifications.CurrentNotifications

class NotificationController extends ApplicationBase {
  
  lazy val UserSession = interface[querki.session.Session]

  // TODO: this is old UI, and should go away
  def showNotifications = withUser(true) { rc =>
    // IMPORTANT: this is a comprehension of Futures!
    for {
      recentNotes <- UserSession.getNotifications(rc.requesterOrAnon)
      identityIds = recentNotes.notes.map(_.sender)
      identities <- IdentityAccess.getIdentities(identityIds)
    }
      yield Ok(views.html.showNotifications(rc, recentNotes, identities))
  }
}
